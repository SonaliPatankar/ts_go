AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Go Notes Lambda with Docker and CORS
Resources:
  NotesApiGateway:
    Type: AWS::Serverless::Api
    Properties:
      Name: NotesApiGateway
      StageName: Prod
      Cors:
        AllowMethods: '''GET,POST,PUT,DELETE,OPTIONS'''
        AllowHeaders: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
        AllowOrigin: '''*'''
  NotesFunction:
    Type: AWS::Serverless::Function
    Metadata:
      DockerContext: D:\sonali_workspace\ts_go\server
      Dockerfile: Dockerfile
      SamResourceId: NotesFunction
    Properties:
      PackageType: Image
      Architectures:
      - x86_64
      Timeout: 10
      MemorySize: 128
      Events:
        LoginApi:
          Type: Api
          Properties:
            Path: /login
            Method: POST
            RestApiId:
              Ref: NotesApiGateway
        NotesApi:
          Type: Api
          Properties:
            Path: /notes
            Method: ANY
            RestApiId:
              Ref: NotesApiGateway
        NotesById:
          Type: Api
          Properties:
            Path: /notes/{id}
            Method: ANY
            RestApiId:
              Ref: NotesApiGateway
      ImageUri: notesfunction:latest
